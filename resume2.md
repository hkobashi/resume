### プロジェクト概要
- 生徒学習支援システム開発

### 使用技術
- 利用言語：Java11(サーバー側), Javascript(フロントエンド側), MySQL(8.0)
- フレームワーク：SpringBoot, jQuery
- インフラ：AWS(  
  EC2, RDS(Aurora), ELB(ALB), S3, Route53, ElastiCache（Redis）  
  CodePipeline, CodeBuild, CodeDeploy,  
  IAM, WAF, GuardDuty, SecurityHub, Inspector, VPC FlowLogs  
  Config, SSM,  
  Chatbot  
  )

### チーム情報
- PdM 1名、PL 1名、開発者9名、インフラ1名  
→システム非機能要件定義およびインフラ設計・構築を担当

### 担当業務
- `システム非機能要件定義`  
  担保する可用性（業務継続性）ラインや障害時のシステム復旧時間（RTO）、  
  セキュリティ要件を顧客と折衝して定義した。  
  →「相手が実現したいことの妥当性」を考えることから話をしていた
- `アーキテクチャ設計および構築（AWS）`（  
  非機能要件を満たすためのアーキテクチャ設計および構築、  
  セキュリティ要件を満たすためのサービス選定やネットワーク構成を設計、  
  非機能要件にて定義した可用性を満たすためのスケーリングポリシーの設計および設定、  
  Blue/Greenデプロイ、セッション切り出しを組み合わせたWeb/APサーバ（EC2）のエフェメラル化   
  ）  
  →当サービスはリリースから2年弱で数万MAUまで拡大する見込みだったため、  
    動的なスケーリング、可用性を実現する必要があった。  
  また、自社におけるAWSアーキテクチャに関する知見が属人的になっていたため  
  開発チームがAWS側の構成を意識する必要がないように運用保守性にも配慮して構築した。
- `セキュリティ対策`（  
  Inspectorを用いたAPサーバーの脆弱性、GuardDutyを用いた不正アクティビティを検知するための設定  
  SQLインジェクションやXSSを防ぐためのWAF設置、  
  ）  
  →インターネット経由で不特定多数のユーザーに使われることを想定していたため
- `CI/CD構築`（  
  GitHubへのPushを起点にCodeBuildによる自動ビルドを実装。（ビルドツールはGradleを採用）  
  前段のCIをパスしたらCodeDeployによるCDを実行、  
  ※本番（商用）環境についてはPdM、PLによる承認プロセスを追加して  
  ChatbotでCI/CDの結果をSlackで通知するよう設定  
  ※開発チームの負荷軽減のため。  
  ）  
- `サーバー構築の自動化（オートスケーリング）`  
  ミドルウェアなど必要な環境を構築するスクリプトを作成して  
  userdata（起動時実行スクリプト）を使って環境構築を簡易化した。  
  ※本プロジェクトで作成したuserdataはさまざまなプロジェクトで使用、改良されている。  
  →自社のCLI操作のスキルを習熟できている人がほぼいなくデプロイ作業などが  
  属人化しつつあったため、「CLI操作を意識する必要がない」仕組みを構築する必要があった

### どんな課題があったのか
- `現行で運用しているWebアプリの可用性やスケーリングが困難であること。`  
  ＜背景＞  
  当プロジェクトで開発するアプリは小・中学校をターゲットに作成された勉強支援ツールである。  
  （教師は生徒の勉強状況の可視化、生徒は勉強時間の測定や課題提出など授業に必要な機能を備えている）  
  昨今のコロナ禍により需要が増えたことにより利用者数が増え、システムダウンが懸念されている。  
  インフラ環境はオンプレでWeb、AP、DBが一つのサーバーで構築されていて、加えて構築担当者が  
  退職していることもありサーバーの設定や構築状況がブラックボックス化してしまっていた。  
  サーバー用のアンチウイルスソフトもインストールされているためアプリの動作が鈍重になることがしばしばあった。  
  当プロジェクトを機にアプリの刷新およびスケーリングの容易化のためにインフラにクラウドを使う運びとなった。

### どうやって課題を解決したのか
- `EC2AutoScalingを設定することでスケーリングを自動化した。`  
  AuroraAutoScalingを使ってリードレプリカの自動スケーリングを実現することで  
  スパイクアクセスによるリードタイムの増加リスクを仕組みで軽減させた。
- `EC2の脆弱性や不正アクティビティなどを検知するために`  
  InspectorやVPC FlowLogs/GuardDutyを設定した。  
  EC2については全てプライベートサブネットに配置することでインターネット側から見えないようにした。  
  また、EC2への唯一のアクセス経路となるELBからのHTTP通信についても  
  WAFを使うことでXSSやSQLインジェクションを弾くよう設定した。

### 工夫した点
- `Javaプログラムのビルド自動化した。`（受託含む自社プロジェクトで前例なし）  
  ビルド・デプロイ頻度を月/6回程度→月/21回程度に向上させ、ビルド・デプロイに関する手作業の工数を0にした。  
  ※デプロイ方式にはBlue/Greenデプロイを採用しているためシステムのダウンタイムを最小化している。
- `サーバー構築スクリプトの汎用化`
  本プロジェクトで使用したJava用の環境構築スクリプトや  
  Python, PHP用の環境構築スクリプトを誰でも汎用的に使えるようにGitHubで公開した。  
  ※基本的にプログラミング言語のバージョンを指定するだけで使用できるようにした
- `環境固有ファイルの最小化`
  本プロジェクトでは検証（開発チーム確認用）、ステージング（顧客確認用）、本番環境（商用環境）の  
  3つがあり、各環境ごとに機密情報（外部APIキーやDB接続情報など）を作成して運用していたが、  
  今後の改修などで秘匿したい機密情報などが大幅に増えてしまうことを懸念していた。  
  回避策としてCodeBuildで各環境用の環境変数を設定して設定ファイルの機密情報の箇所を  
  環境変数に置換（sed）することで管理対象を3分の1にした。  
  ※副次的ではあるが機密情報を記述するソースコードや設定ファイルを他プロジェクトに流用する際に  
  機密情報が流出してしまうリスクを防ぐことができるようになった。